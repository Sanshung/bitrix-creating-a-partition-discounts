# bitrix-creating-a-partition-discounts
Bitrix - создание раздела со скидками

нашел на сайте https://dd-blog.ru/bitrix-creating-a-partition-discounts/

При разработке интернет магазина потребовалось создать страницу, на которой бы отображались товары со скидками. Скидки в системе устанавливаются через Маркетинговые Предложения по средствам Правил работы с корзиной.

По сути задача сводится к созданию страницы /sale/ на которой необходимо разместить компонент bitrix:catalog.section и настроить у него выборку по товарам, на которые действует скидка.

При разработке интернет магазина потребовалось создать страницу, на которой бы отображались товары со скидками. Скидки в системе устанавливаются через Маркетинговые Предложения по средствам Правил работы с корзиной.

По сути задача сводится к созданию страницы /sale/ на которой необходимо разместить компонент bitrix:catalog.section и настроить у него выборку по товарам, на которые действует скидка.

Как создать страницу товаров со скидками?
Для примера создадим такую страницу на базе стандартного шаблона Интернет Магазина Bitrix. Для начала необходимо создать страницу /sale/ и добавить её в меню для вывода.


На странице /sale/ необходимо разместить компонент элементы раздела - bitrix:catalog.section, в настройках обязательно выбрать "Показывать все элементы, если не указан раздел".

Теперь настроим массив со значениями фильтра для фильтрации элементов (arrFilter). Для этого создадим класс, который формирует массив с ID товаров у которых есть действующая скидка в данный момент и для данного пользователя:

Этот код нужно разместить в файле init.php ( /bitrix/php_interface/init.php ), после этого можем использовать класс AllProductDiscount. Преимущество данного класса заключается в быстрой обработки большого количества товаров со скидками.

Откроем файл /sale/index.php, перед вызовом компонента bitrix:catalog.section разместим код:

<?
	$res = AllProductDiscount::getFull(
	array("ACTIVE" => "Y", "SITE_ID" => SITE_ID),
	array()
	);
	foreach($res['IDS'] as $ID) {
    	$sale_id[] = $ID;
	}
	$GLOBALS['arrFilter'] = array("ID"=>$sale_id);
?>

Внимание! Не забываем, чтобы имя массива со значениями фильтра для фильтрации элементов в настройках компонента bitrix:catalog.section было arrFilter.
